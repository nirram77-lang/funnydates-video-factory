<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ FunnyDates Video Factory</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¬</text></svg>">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px;
        }
        .header h1 {
            font-size: 2.2em;
            background: linear-gradient(90deg, #ff6b35, #f7931e, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p { color: #888; margin-top: 5px; }
        .version-badge {
            display: inline-block;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-top: 10px;
        }
        
        /* Control Panel */
        .control-panel {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 25px;
            margin: 20px auto;
            max-width: 900px;
            text-align: center;
        }
        .control-panel h2 { color: #ffd700; margin-bottom: 15px; }
        
        .config-section {
            background: #0a0a0a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .config-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .config-group {
            flex: 1;
            min-width: 250px;
            text-align: right;
        }
        .config-group label {
            color: #ffd700;
            font-size: 13px;
            display: block;
            margin-bottom: 8px;
        }
        .config-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #1a1a2e;
            color: #fff;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .config-group input:focus {
            border-color: #ffd700;
            outline: none;
        }
        
        .btn-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        .btn:hover { transform: scale(1.05); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-save { background: linear-gradient(90deg, #22c55e, #16a34a); color: #fff; }
        .btn-test { background: linear-gradient(90deg, #3b82f6, #2563eb); color: #fff; }
        .btn-primary { background: linear-gradient(90deg, #ff6b35, #f7931e); color: #fff; }
        .btn-video { background: linear-gradient(90deg, #9333ea, #7c3aed); color: #fff; }
        
        .status-badge {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 13px;
        }
        .status-badge.connected { background: #22c55e30; color: #22c55e; border: 1px solid #22c55e; }
        .status-badge.disconnected { background: #ef444430; color: #ef4444; border: 1px solid #ef4444; }
        
        .mega-btn {
            padding: 22px 50px;
            font-size: 1.3em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(90deg, #9333ea, #7c3aed, #6366f1);
            color: #fff;
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.8); }
        }
        .mega-btn:hover { transform: scale(1.05); }
        .mega-btn:disabled { opacity: 0.6; cursor: not-allowed; animation: none; transform: none; }
        
        /* Chapter Display */
        .chapter-display {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 2px solid #9333ea;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 900px;
            display: none;
        }
        .chapter-display.active { display: block; }
        .chapter-display h3 { color: #9333ea; text-align: center; margin-bottom: 15px; }
        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .chapter-item {
            background: #0a0a0a;
            padding: 12px;
            border-radius: 8px;
        }
        .chapter-item label { color: #ffd700; font-size: 11px; display: block; margin-bottom: 4px; }
        .chapter-item .value { color: #22c55e; font-size: 14px; }
        
        /* Pipeline */
        .pipeline {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-width: 900px;
            margin: 20px auto;
        }
        .step {
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 18px 10px;
            text-align: center;
            transition: all 0.3s;
        }
        .step.active {
            border-color: #ffd700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.7); }
        }
        .step.done { border-color: #22c55e; background: linear-gradient(135deg, #0f2e0f, #1a4a1a); }
        .step.error { border-color: #ef4444; background: linear-gradient(135deg, #2e0f0f, #4a1a1a); }
        .step .icon { font-size: 2em; margin-bottom: 8px; }
        .step .title { font-weight: bold; font-size: 0.95em; }
        .step .status { font-size: 0.75em; color: #888; margin-top: 5px; }
        
        /* Preview Area */
        .preview-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1100px;
            margin: 20px auto;
        }
        .preview-box {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #333;
            border-radius: 15px;
            padding: 20px;
        }
        .preview-box h3 { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .preview-box.image h3 { color: #ff6b35; }
        .preview-box.video h3 { color: #9333ea; }
        .preview-content {
            width: 100%;
            min-height: 300px;
            background: #0a0a0a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .preview-content img, .preview-content video {
            max-width: 100%;
            max-height: 320px;
            border-radius: 8px;
        }
        .placeholder { text-align: center; color: #555; }
        .placeholder .icon { font-size: 3.5em; margin-bottom: 10px; }
        
        /* Progress Bar */
        .progress-container {
            background: #0a0a0a;
            border-radius: 10px;
            height: 28px;
            margin: 15px 0;
            overflow: hidden;
            display: none;
        }
        .progress-container.active { display: block; }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #ffd700, #22c55e);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #000;
        }
        
        /* Download Section */
        .download-section {
            background: linear-gradient(135deg, #22c55e15, #16a34a15);
            border: 2px solid #22c55e;
            border-radius: 15px;
            padding: 25px;
            margin: 20px auto;
            max-width: 900px;
            text-align: center;
            display: none;
        }
        .download-section.active { display: block; }
        .download-section h3 { color: #22c55e; margin-bottom: 15px; font-size: 1.3em; }
        .download-btns { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .download-btns .btn { padding: 15px 30px; font-size: 1em; }
        
        /* Log Console */
        .log-section { max-width: 1100px; margin: 20px auto; }
        .log-section h3 { color: #ffd700; margin-bottom: 10px; }
        .log-console {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            max-height: 160px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
        }
        .log-entry { padding: 3px 0; border-bottom: 1px solid #1a1a1a; }
        .log-entry:last-child { border-bottom: none; }
        .log-entry.info { color: #3b82f6; }
        .log-entry.success { color: #22c55e; }
        .log-entry.error { color: #ef4444; }
        .log-entry.warning { color: #f59e0b; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .preview-area { grid-template-columns: 1fr; }
            .pipeline { grid-template-columns: repeat(2, 1fr); }
            .mega-btn { padding: 18px 35px; font-size: 1.1em; }
            .config-row { flex-direction: column; }
            .chapter-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¬ FunnyDates Video Factory</h1>
        <p>×œ×—×™×¦×” ××—×ª = ×ª××•× ×” + ×•×™×“××• ××•×›×Ÿ ×œ×”×•×¨×“×”!</p>
        <div class="version-badge">ğŸš€ Hollywood Automation</div>
    </div>
    
    <!-- Control Panel -->
    <div class="control-panel">
        <h2>ğŸ¯ ×”×’×“×¨×•×ª</h2>
        
        <div class="config-section">
            <div class="config-row">
                <div class="config-group">
                    <label>ğŸ”‘ Replicate API Token:</label>
                    <input type="password" id="apiToken" placeholder="r8_xxxx... (×§×‘×œ ×‘×—×™× × ×-replicate.com)">
                </div>
            </div>
            
            <div class="btn-row">
                <button class="btn btn-save" onclick="saveConfig()">ğŸ’¾ ×©××•×¨</button>
                <button class="btn btn-test" onclick="testConnection()">ğŸ”Œ ×‘×“×•×§ ×—×™×‘×•×¨</button>
                <div class="status-badge disconnected" id="statusBadge">âŒ ×œ× ××—×•×‘×¨</div>
            </div>
        </div>
        
        <button class="mega-btn" onclick="startPipeline()" id="startBtn">
            ğŸ² ×¤×¨×§ ×¨× ×“×•××œ×™ â†’ ×ª××•× ×” â†’ ×•×™×“××• â†’ ×”×•×¨×“!
        </button>
        
        <p style="margin-top: 15px; font-size: 12px; color: #666;">
            ××™×Ÿ ×œ×š Token? <a href="https://replicate.com/account/api-tokens" target="_blank" style="color: #ffd700;">×§×‘×œ ×‘×—×™× × ×›××Ÿ â†’</a>
        </p>
    </div>
    
    <!-- Chapter Display -->
    <div class="chapter-display" id="chapterDisplay">
        <h3>ğŸ“– ×¤×¨×§ × ×•×›×—×™</h3>
        <div class="chapter-grid">
            <div class="chapter-item">
                <label>×¤×¨×§</label>
                <div class="value" id="dispChapter">-</div>
            </div>
            <div class="chapter-item">
                <label>×›×•×ª×¨×ª</label>
                <div class="value" id="dispTitle">-</div>
            </div>
            <div class="chapter-item">
                <label>Hook ×¢×‘×¨×™×ª ğŸ‡®ğŸ‡±</label>
                <div class="value" id="dispHookHeb">-</div>
            </div>
            <div class="chapter-item">
                <label>Hook English ğŸ‡ºğŸ‡¸</label>
                <div class="value" id="dispHookEng">-</div>
            </div>
        </div>
    </div>
    
    <!-- Pipeline Steps -->
    <div class="pipeline">
        <div class="step" id="step1">
            <div class="icon">ğŸ²</div>
            <div class="title">×‘×—×™×¨×ª ×¤×¨×§</div>
            <div class="status">×××ª×™×Ÿ</div>
        </div>
        <div class="step" id="step2">
            <div class="icon">ğŸ¨</div>
            <div class="title">×™×¦×™×¨×ª ×ª××•× ×”</div>
            <div class="status">×××ª×™×Ÿ</div>
        </div>
        <div class="step" id="step3">
            <div class="icon">ğŸ¬</div>
            <div class="title">×™×¦×™×¨×ª ×•×™×“××•</div>
            <div class="status">×××ª×™×Ÿ</div>
        </div>
        <div class="step" id="step4">
            <div class="icon">âœ…</div>
            <div class="title">××•×›×Ÿ!</div>
            <div class="status">×××ª×™×Ÿ</div>
        </div>
    </div>
    
    <!-- Preview Area -->
    <div class="preview-area">
        <div class="preview-box image">
            <h3>ğŸ–¼ï¸ ×ª××•× ×”</h3>
            <div class="preview-content" id="imagePreview">
                <div class="placeholder">
                    <div class="icon">ğŸ¨</div>
                    <p>×”×ª××•× ×” ×ª×•×¤×™×¢ ×›××Ÿ</p>
                </div>
            </div>
            <div class="progress-container" id="imageProgress">
                <div class="progress-bar" style="width: 0%">0%</div>
            </div>
        </div>
        <div class="preview-box video">
            <h3>ğŸ¬ ×•×™×“××•</h3>
            <div class="preview-content" id="videoPreview">
                <div class="placeholder">
                    <div class="icon">ğŸ¥</div>
                    <p>×”×•×™×“××• ×™×•×¤×™×¢ ×›××Ÿ</p>
                </div>
            </div>
            <div class="progress-container" id="videoProgress">
                <div class="progress-bar" style="width: 0%">0%</div>
            </div>
        </div>
    </div>
    
    <!-- Download Section -->
    <div class="download-section" id="downloadSection">
        <h3>ğŸ‰ ×”×›×œ ××•×›×Ÿ ×œ×”×•×¨×“×”!</h3>
        <div class="download-btns">
            <button class="btn btn-primary" onclick="downloadImage()">ğŸ–¼ï¸ ×”×•×¨×“ ×ª××•× ×” (PNG)</button>
            <button class="btn btn-video" onclick="downloadVideo()">ğŸ¬ ×”×•×¨×“ ×•×™×“××• (MP4)</button>
        </div>
    </div>
    
    <!-- Log Console -->
    <div class="log-section">
        <h3>ğŸ“‹ ×™×•××Ÿ ×¤×¢×•×œ×•×ª</h3>
        <div class="log-console" id="logConsole"></div>
    </div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAPTERS DATA - Based on "101 ×“×™×™×˜×™× ×•××£ × ×©×™×›×”"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const chapters = [
    { id: 1, chapter: "×¤×¨×§ 1", title: "×¡×œ×™ ×—×’×™× ×•××”×‘×” ×§×•×¡××™×ª",
      imagePrompt: "ULTRA SURREAL: Jewish grandmother astronaut in space launching gift baskets with challah toward single man on tiny planet, hearts and stars, cosmic matchmaking, Pixar meets Dali, 8K cinematic",
      hookHebrew: "×›×©××× ×©×•×œ×—×ª ×¡×œ×™ ×—×’ ××”×—×œ×œ... ğŸš€ğŸ§º", hookEnglish: "When mom sends care packages from space... ğŸš€ğŸ§º" },
    { id: 2, chapter: "×¤×¨×§ 2", title: "×“×™×™×˜ ×”×™×™×Ÿ ×©×”×ª×¤×•×¦×¥",
      imagePrompt: "SURREAL DISASTER: Two wine-liquid people toasting, glasses exploding into fountains, white tablecloth destroyed, waiter horrified, romantic disaster comedy, hyperrealistic, 8K",
      hookHebrew: "×¨×¦×™×ª ×œ×”×¨×©×™× ×¢× ×™×™×Ÿ ×™×§×¨? ×”× ×” ××” ×©×§×¨×”... ğŸ·ğŸ’¥", hookEnglish: "Tried fancy wine to impress? Here's what happened... ğŸ·ğŸ’¥" },
    { id: 3, chapter: "×¤×¨×§ 3", title: "×”× ×¢×œ ×©×’× ×‘×” ××ª ×”×”×¦×’×”",
      imagePrompt: "ABSURD COMEDY: Giant designer high heel shoe on restaurant date with tiny embarrassed man, shoe has lipstick and winning the conversation, other diners are shoes, 8K",
      hookHebrew: "×”× ×¢×œ ×©×œ×” × ×™×¦×—×” ××•×ª×™ ×‘×“×™×™×˜ ğŸ‘ ğŸ˜…", hookEnglish: "Her shoe won the date ğŸ‘ ğŸ˜…" },
    { id: 4, chapter: "×¤×¨×§ 4", title: "×™×¢×¨ ×”×“×’×œ×™× ×”××“×•××™×",
      imagePrompt: "PSYCHOLOGICAL SURREAL: Person walking happily through forest of giant red warning flags, each flag showing dating red flag, person wearing heart-shaped glasses oblivious, dark humor, 8K",
      hookHebrew: "××™×š ×œ× ×¨××™×ª×™ ××ª ×›×œ ×”×“×’×œ×™× ×”××“×•××™×?! ğŸš©â¤ï¸", hookEnglish: "How did I miss all the red flags?! ğŸš©â¤ï¸" },
    { id: 5, chapter: "×¤×¨×§ 5", title: "×”×¤×¨×¤×¨×™× ×©×”×©×ª×œ×˜×•",
      imagePrompt: "WHIMSICAL HORROR: Person with transparent glass stomach filled with thousands of crazy butterflies escaping through mouth during date, beautiful chaos, 8K",
      hookHebrew: "×–×” ×œ× ×¤×¨×¤×¨×™× ×‘×‘×˜×Ÿ. ×–×” ×¤×× ×™×§×”. ğŸ¦‹ğŸ˜°", hookEnglish: "Those aren't butterflies. That's panic. ğŸ¦‹ğŸ˜°" },
    { id: 6, chapter: "×¤×¨×§ 6", title: "×”×©×—×£ ×©×”×¨×¡ ×”×›×œ",
      imagePrompt: "ACTION COMEDY: Seagull with aviator sunglasses crashing through restaurant window in slow motion, stealing fish from romantic dinner, explosion behind, Michael Bay style, 8K",
      hookHebrew: "×©×—×£ ××—×“. ×“×™×™×˜ ××—×“. ××¤×¡ ×¡×™×›×•×™×™×. ğŸ¦…ğŸ½ï¸", hookEnglish: "One seagull. One date. Zero chances. ğŸ¦…ğŸ½ï¸" },
    { id: 7, chapter: "×¤×¨×§ 7", title: "×”×‘×¨×™×›×” ×©×—×©×¤×” ×¡×•×“×•×ª",
      imagePrompt: "SURREAL REVELATION: Person diving into hotel pool, underwater reveals embarrassing secrets floating - photos, browser history, texts, shocked diver face, 8K",
      hookHebrew: "×”×‘×¨×™×›×” ×—×©×¤×” ×™×•×ª×¨ ××“×™... ğŸŠâ€â™‚ï¸ğŸ˜³", hookEnglish: "The pool revealed too much... ğŸŠâ€â™‚ï¸ğŸ˜³" },
    { id: 8, chapter: "×¤×¨×§ 8", title: "×”×ª×¤×¨×™×˜ ×”××™× ×¡×•×¤×™",
      imagePrompt: "INFINITE ABSURD: Couple at restaurant, menu unfolds infinitely filling universe, smoke waiter waiting eternally, decision paralysis, MC Escher style, 8K",
      hookHebrew: "××•×›× ×™× ×œ×”×–××™×Ÿ? ×œ×. ××£ ×¤×¢× ×œ×. ğŸ“œâ™¾ï¸", hookEnglish: "Ready to order? No. Never. ğŸ“œâ™¾ï¸" },
    { id: 9, chapter: "×¤×¨×§ 9", title: "×”×•×“×¢×•×ª ×©×¨×•×“×¤×•×ª",
      imagePrompt: "DIGITAL HORROR: Giant phone screen, old WhatsApp messages crawling out as 3D monsters chasing sender through chat bubble city, blue checkmarks as eyes, 8K",
      hookHebrew: "××—×§×ª? ×”×Ÿ ×–×•×›×¨×•×ª. ğŸ“±ğŸ‘»", hookEnglish: "Deleted? They remember. ğŸ“±ğŸ‘»" },
    { id: 10, chapter: "×¤×¨×§ 10", title: "××©×•×œ×© ××”×‘×” ×’×™××•××˜×¨×™",
      imagePrompt: "GEOMETRIC ROMANCE: Three people as geometric shapes trying to hug in Escher-impossible space, stairs to nowhere, mathematically impossible romance, 8K",
      hookHebrew: "×”××”×‘×” ×©×œ× ×• ×œ× ××¡×ª×“×¨×ª ×’×™××•××˜×¨×™×ª ğŸ“ğŸ’”", hookEnglish: "Our love doesn't compute geometrically ğŸ“ğŸ’”" },
    { id: 11, chapter: "×¤×¨×§ 11", title: "×”×˜×œ×¤×•× ×™× ×©×”×ª××”×‘×•",
      imagePrompt: "RETRO ROMANCE: Two vintage rotary phones on candlelit dinner, cords intertwining like holding hands, hearts floating from receivers, humans jealous in background, 8K",
      hookHebrew: "×œ×¤×—×•×ª ×”×˜×œ×¤×•× ×™× ×©×œ× ×• ××¡×ª×“×¨×™×... ğŸ“ğŸ’•", hookEnglish: "At least our phones are compatible... ğŸ“ğŸ’•" },
    { id: 12, chapter: "×¤×¨×§ 12", title: "×××œ×›×ª ×”×—×ª×•×œ×™×",
      imagePrompt: "CAT DIMENSION: Woman on throne made entirely of fluffy cats, palace where everything is cats - furniture, chandelier, art, cat-snow falling outside, peak cat lady, 8K",
      hookHebrew: "×—×ª×•×œ ××—×“? ×™×© ×œ×™ ×××œ×›×”. ğŸ±ğŸ‘‘", hookEnglish: "One cat? I have a kingdom. ğŸ±ğŸ‘‘" },
    { id: 13, chapter: "×¤×¨×§ 13", title: "×”×‘××¨ ×©××¨××” ×××ª",
      imagePrompt: "MYSTICAL WARNING: Ancient wishing well in moonlit forest, golden liquid shows visions of dating disasters, coins frozen mid-fall, fireflies spelling RUN, 8K",
      hookHebrew: "×‘×™×§×©×ª×™ ××”×‘×”. ×”×‘××¨ ×¦×—×§×”. âœ¨ğŸŒ™", hookEnglish: "Wished for love. The well laughed. âœ¨ğŸŒ™" },
    { id: 14, chapter: "×¤×¨×§ 14", title: "××¡×™×‘×” ××¨×•×‘×ª ×××“×™×",
      imagePrompt: "MULTIVERSE PARTY: Bachelorette party with same bride from parallel universes - fire bride, ice bride, flower bride - dancing in dimension-glitching club, 8K",
      hookHebrew: "××¡×™×‘×” ××—×ª. ××™× ×¡×•×£ ×›×œ×•×ª. ğŸ‰ğŸ‘°â€â™€ï¸", hookEnglish: "One party. Infinite brides. ğŸ‰ğŸ‘°â€â™€ï¸" },
    { id: 15, chapter: "×¤×¨×§ 15", title: "×§××¤×§×™×™×§×¡ ×‘×˜×™×¤×•×œ",
      imagePrompt: "EMOTIONAL DESSERTS: Giant cupcakes with expressive faces at therapy group, one crying frosting tears, one angry with flames, pastel therapy room, 8K",
      hookHebrew: "×’× ×”×§××¤×§×™×™×§×¡ ×¦×¨×™×›×™× ×˜×™×¤×•×œ ğŸ§ğŸ˜­", hookEnglish: "Even cupcakes need therapy ğŸ§ğŸ˜­" },
    { id: 16, chapter: "×¤×¨×§ 16", title: "×“×™×™×˜ ×”×¤×•×š",
      imagePrompt: "GRAVITY DEFIED: Couple on date in loft where furniture floats randomly, coffee going UP from cups, Inception romantic comedy, impossible perspectives, 8K",
      hookHebrew: "×”×“×™×™×˜ ×”×ª×”×¤×š ×¢×œ×™×™. ×¤×©×•×˜×• ×›××©××¢×•. ğŸ™ƒâ˜•", hookEnglish: "The date turned on me. Literally. ğŸ™ƒâ˜•" },
    { id: 17, chapter: "×¤×¨×§ 17", title: "×˜×™×¤×ª ×”×™×™×Ÿ ×”×§×•×¡××™×ª",
      imagePrompt: "COSMIC DISASTER: Wine drop in extreme slow motion toward white dress, inside drop is entire galaxy with planets, woman's horrified frozen face, 8K",
      hookHebrew: "×”×˜×™×¤×” ×”×–×• ×”×›×™×œ×” ×™×§×•× ×©×œ ××¡×•×Ÿ ğŸ·ğŸ˜±", hookEnglish: "That drop contained a universe of disaster ğŸ·ğŸ˜±" },
    { id: 18, chapter: "×¤×¨×§ 18", title: "××”×‘×” ×“×™×’×™×˜×œ×™×ª",
      imagePrompt: "DIGITAL DIVIDE: Two people inside phone screens floating in binary void, hands reaching trying to touch across digital divide, pixels and hearts floating, 8K",
      hookHebrew: "×”××¡×š ××—×‘×¨? ×”××¡×š ××¤×¨×™×“. ğŸ“±ğŸ’”", hookEnglish: "Screen connects? Screen divides. ğŸ“±ğŸ’”" },
    { id: 19, chapter: "×¤×¨×§ 19", title: "×©×ª×™ ×¨×’×œ×™×™× ×©×××œ×™×•×ª",
      imagePrompt: "DIRECTIONAL CHAOS: Person with left shoes on both feet, right shoes as gloves, walking backwards on circular sidewalk, signs pointing wrong directions, 8K",
      hookHebrew: "×”×›×œ ×”×¤×•×š. ×’× ×”× ×¢×œ×™×™×. ğŸ‘ŸğŸ”„", hookEnglish: "Everything backwards. Even shoes. ğŸ‘ŸğŸ”„" },
    { id: 20, chapter: "×¤×¨×§ 20", title: "×¨×™×§×•×“ ×¡×•×£ ×”×¢×•×œ×",
      imagePrompt: "APOCALYPTIC ROMANCE: Couple slow dancing on rooftop, multiple suns rising, aurora borealis, shooting stars, beautiful end of world, bittersweet silhouettes, 8K",
      hookHebrew: "×”×¢×•×œ× × ×’××¨. ×”×¨×™×§×•×“ ×œ×. ğŸ’«ğŸŒ…", hookEnglish: "World ending. Dance isn't. ğŸ’«ğŸŒ…" },
    { id: 21, chapter: "×¤×¨×§ 21", title: "××™×œ×™× ×©× ×ª×§×¢×•",
      imagePrompt: "UNSPOKEN WORDS: Silent couple at dinner, words trapped in bubbles - I love you, Sorry, Stay, Goodbye - some popping, others escaping window, melancholic, 8K",
      hookHebrew: "×›×œ ×”××™×œ×™× ×©× ×ª×§×¢×• ×‘×’×¨×•×Ÿ ğŸ’­ğŸ˜¶", hookEnglish: "All words stuck in throat ğŸ’­ğŸ˜¶" },
    { id: 22, chapter: "×¤×¨×§ 22", title: "×¨×™×§×•×“ ×‘×–××Ÿ",
      imagePrompt: "TIME-BENDING: Elderly couple dancing in empty ballroom, with each spin becoming younger, ballroom transforming through decades, golden memory tornado, 8K",
      hookHebrew: "×›×œ ×¨×™×§×•×“ ××—×–×™×¨ ××•×ª× ×• ×‘×–××Ÿ ğŸ’‘â°", hookEnglish: "Each dance takes us back in time ğŸ’‘â°" },
    { id: 23, chapter: "×¤×¨×§ 23", title: "×”×¡×¤×¨ ×©×›×•×ª×‘ ××ª ×¢×¦××•",
      imagePrompt: "META FINALE: Book floating in space writing itself, pages turning showing reader reading, infinite recursive loop, all characters orbiting like satellites, 8K",
      hookHebrew: "×”×¡×¤×¨ ×”×–×” ×›×•×ª×‘ ××•×ª×š ğŸ“–âœ¨", hookEnglish: "This book writes you ğŸ“–âœ¨" }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const state = {
    apiToken: '',
    currentChapter: null,
    imageBlob: null,
    imageUrl: null,
    videoUrl: null,
    processing: false,
    connected: false
};

// Backend URL - automatically detect
const BACKEND_URL = window.location.origin;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
    // Load saved token
    const saved = localStorage.getItem('funnydates_token');
    if (saved) {
        document.getElementById('apiToken').value = saved;
        state.apiToken = saved;
        testConnection();
    }
    log('ğŸ¬ FunnyDates Video Factory ××•×›×Ÿ!', 'success');
    log(`ğŸ“¡ Backend: ${BACKEND_URL}`, 'info');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGGING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function log(msg, type = 'info') {
    const console = document.getElementById('logConsole');
    const entry = document.createElement('div');
    entry.className = `log-entry ${type}`;
    const time = new Date().toLocaleTimeString('he-IL');
    entry.textContent = `[${time}] ${msg}`;
    console.appendChild(entry);
    console.scrollTop = console.scrollHeight;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveConfig() {
    const token = document.getElementById('apiToken').value.trim();
    if (token) {
        state.apiToken = token;
        localStorage.setItem('funnydates_token', token);
        log('ğŸ’¾ Token × ×©××¨!', 'success');
        testConnection();
    } else {
        log('âŒ ×”×›× ×¡ Token', 'error');
    }
}

async function testConnection() {
    log('ğŸ”Œ ×‘×•×“×§ ×—×™×‘×•×¨...', 'info');
    
    try {
        const response = await fetch(`${BACKEND_URL}/api/replicate?action=test`);
        const data = await response.json();
        
        if (data.status === 'ok') {
            updateStatus(true);
            log('âœ… Backend ××—×•×‘×¨!', 'success');
        } else {
            updateStatus(false);
            log('âŒ Backend ×œ× ×–××™×Ÿ', 'error');
        }
    } catch (error) {
        updateStatus(false);
        log(`âŒ ×©×’×™××ª ×—×™×‘×•×¨: ${error.message}`, 'error');
    }
}

function updateStatus(connected) {
    state.connected = connected;
    const badge = document.getElementById('statusBadge');
    if (connected) {
        badge.className = 'status-badge connected';
        badge.textContent = 'âœ… ××—×•×‘×¨!';
    } else {
        badge.className = 'status-badge disconnected';
        badge.textContent = 'âŒ ×œ× ××—×•×‘×¨';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN PIPELINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startPipeline() {
    if (state.processing) return;
    
    if (!state.apiToken) {
        alert('âš ï¸ ×”×›× ×¡ Replicate API Token ×§×•×“×!');
        return;
    }
    
    state.processing = true;
    const btn = document.getElementById('startBtn');
    btn.disabled = true;
    
    resetUI();
    
    try {
        // STEP 1: Random Chapter
        updateStep(1, 'active', 'ğŸ² ×‘×•×—×¨...');
        const chapter = chapters[Math.floor(Math.random() * chapters.length)];
        state.currentChapter = chapter;
        showChapter(chapter);
        await sleep(500);
        updateStep(1, 'done', 'âœ…');
        log(`ğŸ“– ${chapter.chapter}: ${chapter.title}`, 'success');
        
        // STEP 2: Generate Image
        updateStep(2, 'active', 'ğŸ¨ ×™×•×¦×¨...');
        await generateImage(chapter);
        updateStep(2, 'done', 'âœ…');
        
        // STEP 3: Generate Video
        updateStep(3, 'active', 'ğŸ¬ ×™×•×¦×¨...');
        await generateVideo();
        updateStep(3, 'done', 'âœ…');
        
        // STEP 4: Done!
        updateStep(4, 'done', 'ğŸ‰');
        document.getElementById('downloadSection').classList.add('active');
        log('ğŸ‰ ×”×›×œ ××•×›×Ÿ! ×”×•×¨×“ ××ª ×”×§×‘×¦×™×!', 'success');
        
    } catch (error) {
        log(`âŒ ×©×’×™××”: ${error.message}`, 'error');
        const activeStep = document.querySelector('.step.active');
        if (activeStep) activeStep.classList.replace('active', 'error');
    } finally {
        state.processing = false;
        btn.disabled = false;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMAGE GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generateImage(chapter, attempt = 1) {
    const maxAttempts = 5;
    
    try {
        log(`ğŸ¨ ×™×•×¦×¨ ×ª××•× ×” (${attempt}/${maxAttempts})...`, 'info');
        showProgress('imageProgress', 10);
        
        const prompt = encodeURIComponent(chapter.imagePrompt);
        const seed = Date.now() + attempt;
        const url = `https://image.pollinations.ai/prompt/${prompt}?width=1024&height=1024&seed=${seed}&nologo=true`;
        
        showProgress('imageProgress', 30);
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 60000);
        
        const response = await fetch(url, { signal: controller.signal });
        clearTimeout(timeoutId);
        
        if (response.status === 429) {
            throw new Error('RATE_LIMIT');
        }
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        
        showProgress('imageProgress', 70);
        
        const blob = await response.blob();
        state.imageBlob = blob;
        state.imageUrl = URL.createObjectURL(blob);
        
        showProgress('imageProgress', 100);
        document.getElementById('imagePreview').innerHTML = `<img src="${state.imageUrl}" alt="${chapter.title}">`;
        
        log('âœ… ×ª××•× ×” ××•×›× ×”!', 'success');
        hideProgress('imageProgress');
        return true;
        
    } catch (error) {
        if (attempt < maxAttempts) {
            const waitTime = 3000 * attempt;
            log(`â³ Rate limit - ×××ª×™×Ÿ ${waitTime/1000}s...`, 'warning');
            await sleep(waitTime);
            return generateImage(chapter, attempt + 1);
        }
        throw error;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIDEO GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generateVideo() {
    log('ğŸ¬ ×©×•×œ×— ×œ-Replicate...', 'info');
    showProgress('videoProgress', 5);
    
    // Convert image to base64
    const base64 = await blobToBase64(state.imageBlob);
    showProgress('videoProgress', 10);
    
    // Create prediction
    const createResponse = await fetch(`${BACKEND_URL}/api/replicate?action=create`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Token ${state.apiToken}`
        },
        body: JSON.stringify({
            version: "3f0457e4619daac51203dedb472816fd4af51f3149fa7a9e0b5ffcf1b8172438",
            input: {
                input_image: base64,
                video_length: "14_frames_with_svd",
                sizing_strategy: "maintain_aspect_ratio",
                frames_per_second: 6,
                motion_bucket_id: 127,
                cond_aug: 0.02
            }
        })
    });
    
    if (!createResponse.ok) {
        const errorText = await createResponse.text();
        throw new Error(`Create failed: ${errorText}`);
    }
    
    const prediction = await createResponse.json();
    
    if (!prediction.id) {
        throw new Error(prediction.error || 'Failed to create prediction');
    }
    
    log(`ğŸ“¡ ×™×¦×™×¨×” ×”×ª×—×™×œ×”! ID: ${prediction.id.slice(0, 8)}...`, 'success');
    showProgress('videoProgress', 20);
    
    // Poll for completion
    let polls = 0;
    const maxPolls = 60;
    
    while (polls < maxPolls) {
        polls++;
        
        const statusResponse = await fetch(
            `${BACKEND_URL}/api/replicate?action=status&predictionId=${prediction.id}`,
            { headers: { 'Authorization': `Token ${state.apiToken}` } }
        );
        
        const data = await statusResponse.json();
        const progress = 20 + (polls / maxPolls) * 75;
        showProgress('videoProgress', progress);
        
        if (data.status === 'succeeded' && data.output) {
            state.videoUrl = data.output;
            showProgress('videoProgress', 100);
            
            document.getElementById('videoPreview').innerHTML = `
                <video controls autoplay loop muted style="max-width: 100%; border-radius: 8px;">
                    <source src="${state.videoUrl}" type="video/mp4">
                </video>
            `;
            
            log('âœ… ×•×™×“××• ××•×›×Ÿ!', 'success');
            hideProgress('videoProgress');
            return true;
        }
        
        if (data.status === 'failed' || data.status === 'canceled') {
            throw new Error(`Video ${data.status}: ${data.error || 'Unknown error'}`);
        }
        
        if (polls % 10 === 0) {
            log(`â³ ×¡×˜×˜×•×¡: ${data.status} (${Math.round(progress)}%)`, 'info');
        }
        
        await sleep(3000);
    }
    
    throw new Error('Timeout - ×œ×§×— ×™×•×ª×¨ ××“×™ ×–××Ÿ');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function downloadImage() {
    if (!state.imageBlob || !state.currentChapter) return;
    
    const a = document.createElement('a');
    a.href = URL.createObjectURL(state.imageBlob);
    a.download = `funnydates-ch${state.currentChapter.id}-${Date.now()}.png`;
    a.click();
    log('ğŸ’¾ ×ª××•× ×” ×”×•×¨×“×”!', 'success');
}

async function downloadVideo() {
    if (!state.videoUrl || !state.currentChapter) return;
    
    try {
        log('â³ ××•×¨×™×“ ×•×™×“××•...', 'info');
        const response = await fetch(state.videoUrl);
        const blob = await response.blob();
        
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `funnydates-ch${state.currentChapter.id}-${Date.now()}.mp4`;
        a.click();
        log('ğŸ’¾ ×•×™×“××• ×”×•×¨×“!', 'success');
    } catch (error) {
        log('âš ï¸ ×¤×•×ª×— ×‘×—×œ×•×Ÿ ×—×“×©...', 'warning');
        window.open(state.videoUrl, '_blank');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetUI() {
    for (let i = 1; i <= 4; i++) {
        updateStep(i, '', '×××ª×™×Ÿ');
    }
    document.getElementById('chapterDisplay').classList.remove('active');
    document.getElementById('downloadSection').classList.remove('active');
    document.getElementById('imagePreview').innerHTML = '<div class="placeholder"><div class="icon">ğŸ¨</div><p>×”×ª××•× ×” ×ª×•×¤×™×¢ ×›××Ÿ</p></div>';
    document.getElementById('videoPreview').innerHTML = '<div class="placeholder"><div class="icon">ğŸ¥</div><p>×”×•×™×“××• ×™×•×¤×™×¢ ×›××Ÿ</p></div>';
    hideProgress('imageProgress');
    hideProgress('videoProgress');
    state.imageBlob = null;
    state.imageUrl = null;
    state.videoUrl = null;
}

function showChapter(chapter) {
    document.getElementById('chapterDisplay').classList.add('active');
    document.getElementById('dispChapter').textContent = chapter.chapter;
    document.getElementById('dispTitle').textContent = chapter.title;
    document.getElementById('dispHookHeb').textContent = chapter.hookHebrew;
    document.getElementById('dispHookEng').textContent = chapter.hookEnglish;
}

function updateStep(num, status, text) {
    const step = document.getElementById(`step${num}`);
    step.className = `step ${status}`;
    step.querySelector('.status').textContent = text;
}

function showProgress(id, percent) {
    const container = document.getElementById(id);
    container.classList.add('active');
    const bar = container.querySelector('.progress-bar');
    bar.style.width = `${percent}%`;
    bar.textContent = `${Math.round(percent)}%`;
}

function hideProgress(id) {
    document.getElementById(id).classList.remove('active');
}

function blobToBase64(blob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
    });
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
</script>
</body>
</html>
